#!/bin/bash

# This script returns the OS version/channel name from ManagedOSVersion

set -e -x

# Variables
FILE_TO_CHECK=$1
KIND_OF_OS=$2
INVERTED="| not"

# Define if we check for stable or unstable OS
case ${KIND_OF_OS} in
  dev|unstable)
    unset INVERTED
    ;;
esac

# Get the value
# NOTE: don't check for ISO, only container images are used for upgrade
VALUE=$(jq -r ".items[] | select(.spec.metadata.displayName | contains(\"unstable\")${INVERTED}).metadata.name" 2>/dev/null ${FILE_TO_CHECK} \
        | grep -v '\-iso$' \
        | sort \
        | tail -1)

# Return VALUE without \n
echo -n ${VALUE}
