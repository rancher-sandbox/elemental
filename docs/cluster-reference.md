# Cluster reference

A `#!yaml Cluster` definition includes a `#!yaml kubernetesVersion` and a list of `#!yaml machinePools` to deploy the cluster to.

For how to select a `#!yaml kubernetesVersion` please check our [Kubernetes Versions](kubernetesversions.md) page.

A `#!yaml machinePool` is a bundle of configuration with a `#!yaml ObjectReference` so the cluster is deployed to those `#!yaml machinePools`
with the proper roles (etcd, control-plane, worker) with a quantity (how many nodes to deploy from this pool) and some extra configurations (rolling update config, max unhelthy nodes, etc...).

??? example
    ```yaml
    kind: Cluster
    apiVersion: provisioning.cattle.io/v1
    metadata:
      name: ...
      namespace: ...
    spec:
      rkeConfig:
        machinePools:
          - name: ...
            controlPlaneRole: ...
            etcdRole: ...
            workerRole: ...
            quantity: ...
            machineConfigRef:
              apiVersion: elemental.cattle.io/v1beta1
              kind: MachineInventorySelectorTemplate
              name: ...
          - name: ...
            controlPlaneRole: ...
            etcdRole: ...
            workerRole: ...
            quantity: ...
            machineConfigRef:
              apiVersion: elemental.cattle.io/v1beta1
              kind: MachineInventorySelectorTemplate
              name: ...
    ```


## rkeConfig.machinePools

A list of `#!yaml machinePools`. A minimun of 1 `#!yaml machinePools` is required for the cluster to be deployed to.

## machinePools Spec Reference


| Key                  | Type   | Default value   | Description                                                          |
|----------------------|--------|-----------------|----------------------------------------------------------------------|
| controlPlaneRole     | bool   | false           | Set machines in this pool as control-plane                           |
| etcdRole             | bool   | false           | Set machines in this pool as etcd                                    |
| workerRole           | bool   | false           | Set machines in this pool as worker                                  |
| name                 | string | nil             | Name for this pool                                                   |
| quantity             | int    | nil             | Number of machines to deploy from this pool                          |
| unhealthyNodeTimeout | int    | nil             | Timeout for unhealthy node health checks                             |
| machineConfigRef     | int    | ObjectReference | Reference to an object used to know what nodes are part of this pool |

A minimum of `#!yaml quantity` set to one is required for this pool to be used.
Basically translates to how many nodes from this pool are going to be setup for this cluster.

??? example
    ```yaml
    kind: Cluster
    apiVersion: provisioning.cattle.io/v1
    metadata:
      name: cluster-example
      namespace: example-default
    spec:
      rkeConfig:
        machinePools:
          - name: examplePool 
            controlPlaneRole: true
            etcdRole: true
            workerRole: false
            quantity: 3
            unhealthyNodeTimeout: 0s
            machineConfigRef:
              apiVersion: elemental.cattle.io/v1beta1
              kind: MachineInventorySelectorTemplate
              name: exampleSelector
    ```

## machineConfigRef Spec Reference

A `#!yaml machineConfigRef` is a generic k8s `#!yaml ObjectReference` which usually contain a 
`#!yaml kind` `#!yaml name` and `#!yaml apiVersion` to point to a different object.

In Elemental, we set this to a [MachineInventorySelectorTemplate](machineinventoryselectortemplate-reference.md).
This allows us to point to more than one object by using the selector.


### Example


The example below creates a cluster that uses 2 different `#!yaml machinePools` to set different nodes to control-plane and workers nodes,
based on 2 different `#!yaml MachineInventorySelectorTemplate` that select their nodes based on a `#!yaml MachineInventory` label (location)

!!! warning
    The labels for the example are manual set labels, they are not set by Elemental automatically..

    For automatic labels generated by Elemental please check the [SMBIOS](smbios.md) page.


```yaml title="example cluster with more than one machinePool"
--8<-- "examples/clusters/clusters-several-machinepools.yml"
```
